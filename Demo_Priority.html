

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>About Priority Scheduling Algorithm</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="Style_Priority.css">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/typed.js/2.0.11/typed.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Ubuntu&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
</head>

<body>
  <div class="scroll-up-btn">
    <i class="fas fa-angle-up"></i>
  </div>
  <nav class="navbar">
		<div class="max-width">
		  <div class="logo"><a href="index.html">Schedule<span>X.</span></a></div>
		  <ul class="menu">
			<li><a href="index.html" class="menu-btn">Home</a></li>
			<li><a href="About_peterson.html" class="menu-btn">About</a></li>
			<li><a href="index.html#services" class="menu-btn">Algorithms</a></li>
			<li><a href="" class="menu-btn">Guide</a></li>
			<li class="dropdown">
			  <a href="#" class="menu-btn" id="dropdown-btn">Theams       <i class="fas fa-caret-down"></i></a>
			  <ul class="dropdown-content" id="dropdown-content" style="width: 150px; background-color: white;">
				<li><a href="#" style="color: black;padding-left: 0px;padding-right: 0px; margin-left: 10px;" onclick="changeVideo('Videos/Demo_FCFS_Background.mp4')"><span class="rectangle"></span>Theam 1</a></li>
				<li><a href="#" style="color: black;padding-left: 0px;padding-right: 0px; margin-left: 10px;" onclick="changeVideo('Videos/dots-120172.mp4')"><span class="rectangle"></span>Theam 2</a></li>
				<li><a href="#" style="color: black;padding-left: 0px;padding-right: 0px; margin-left: 10px;" onclick="changeVideo('Videos/Demo_Peterson_Background.mp4')"><span class="rectangle"></span>Theam 3</a></li>
        <li class="scrollable"><a href="#" style="color: black;padding-left: 0px;padding-right: 0px; margin-left: 10px;" onclick="changeVideo('Videos/production ID_4478322.mp4')"><span class="rectangle" ></span>Theam 4</a></li>
        <li class="scrollable"><a href="#" style="color: black;padding-left: 0px;padding-right: 0px; margin-left: 10px;" onclick="changeVideo('Videos/video.mp4')"><span class="rectangle" ></span>Theam 5</a></li>
        <li class="scrollable"><a href="#" style="color: black;padding-left: 0px;padding-right: 0px; margin-left: 10px;" onclick="changeVideo('Videos/network-80645.mp4')"><span class="rectangle" ></span>Theam 6</a></li>
				<li><a href="#" style="color: black;padding-left: 0px;padding-right: 0px; margin-left: 10px;" onclick="changeVideo('Videos/black-13495.mp4')"><span class="rectangle"></span>Original</a></li>
			  </ul>
			</li>
		  </ul>
		  <div class="menu-btn">
			<i class="fas fa-bars"></i>
		  </div>
		</div>
	  </nav>

  <video autoplay muted loop play-inline class="video" style="top:0px; left:auto;width: 1920px;" id="backgroundVideo">
		<source src="Videos/black-13495.mp4" type="video/mp4">
	</video>

  <div class="pop-up">
		<div class="popup-overlay"></div>
		<div class="popup">
		  <h2>Welcome to<br> Priority CPU Scheduling !</h2>
		  <p></p>
		  <ul>
			<li>want to know about this Simulator using</li><br>
			<li>
			  <div class="icon-container">
				<a href="Guide/Guide PDF/Peterson guide section.pdf" target="_blank">
				  <img src="Guide/file-pdf-solid.svg" alt="" style="height: 80px; padding-right: 20px;">
				</a>
				<div class="video-container">
				  <a class="video-text" onclick="showVideo()">
					<img src="Guide/video-solid.svg" alt="" style="height: 80px;padding-left: 150px;">
				  </a>
				  <div class="video-popup">
					<iframe width="560" height="315" src="Guide/Guide Videos/Priority CPU Scheduling.mp4" target="_blank" frameborder="0" allowfullscreen></iframe>
					<span class="close-button" onclick="closeVideo()" style="color:aliceblue">x</span>
				  </div>
				</div>
			  </div>
			</li>
		  </ul>
		  <button id="popup-close">Got it!</button>
		</div>
	  </div>

  <div>
    <h1 style="padding-top:170px"><B>PRIORITY CPU SCHEDULING</B></h1>
  </div>
  <section style="padding-top: 0px;">
    <div class="section">
  <div class="table1">
    <table id="processTable">
      <tr>
        <th>ProcessID</th>
        <th>Arrival Time</th>
        <th>CPU Burst Time</th>
        <th>Priority</th>
      </tr>
    </table>
  </div>

  </div>
  <div class="table2">
    <br>
    <form action="index.php" method="post">
      <input type="text" name="processIDInput" id="processIDInput" placeholder="Process ID" onkeypress="return isNumberKey(event)">
      <input type="number" name="arrivalTimeInput" id="arrivalTimeInput" placeholder="Arrival Time">
      <input type="number" name="cpuBurstTimeInput" id="cpuBurstTimeInput" placeholder="CPU Burst Time">
      <input type="number" name="priorityInput" id="priorityInput" placeholder="Priority">
    </form>
  </div>
  </div>

  <div class="button" style="padding-top:20px">
    <button id="addButton" style="margin-left: 350px;font-size:20px">Add Process</button>
    <button id="dropButton" style="margin-left: 30px;font-size:20px">Delete Process</button>
    <button id="reset" style="margin-left:30px;font-size:20px">Reset</button>
    <button id="calculateButton" style="margin-left: 590px;font-size:25px">Calculate</button>
  </div>

  <div class="resultTable1">
    <table class="resultTable" id="resultTable" style="visibility: hidden">
      <tr>
        <th>ProcessID</th>
        <th>Arrival Time</th>
        <th>CPU Burst Time</th>
        <th>Priority</th>
        <th>Completion Time</th>
        <th>Turnaround Time</th>
        <th>Waiting Time</th>
        <th>Start Time</th>
        <th>Response Time</th>
      </tr>
    </table>
  </div>
  <br>
  <div style="color:white;margin-left:500px;visibility: hidden;" id="GanttChart1">
    <table>
      <tr>
      <th style="margin-left:500px"><label style="text-align:center;" for="avgWaitTime" class="resultTable" id="AvgWaitTime">AvgWaiting Time:</label>
      <p id="avgWaitTime"></p></th>
      <th><label style="text-align:center;" for="avgTATime" class="resultTable" id="AvgTATime">Avg
        Turnaround Time:</label>
      <p id="avgTATime"></p>
    </th>
    </tr>
    </table>
      <br>
    
      <table id="GanttChart" style="margin-left:50px">
        <h3>--The GanttChart for the above processes is--</h3>
        <br>
      </table>
    </div>
    <div id="reloadButton" class="reloadButton" style="visibility: hidden;">
      <a href="Demo_Priority.html">Reset</a>
    </div>
  </div>
  </section>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
  </body>
  </html>
  <br>


<!-- Dropdown Script -->

<script>
	document.addEventListener('click', function(event) {
	  var dropdownBtn = document.getElementById('dropdown-btn');
	  var dropdownContent = document.getElementById('dropdown-content');
	  if (!dropdownBtn.contains(event.target)) {
		dropdownContent.style.display = 'none';
	  }
	});
	
	document.getElementById('dropdown-btn').addEventListener('click', function() {
	  var dropdownContent = document.getElementById('dropdown-content');
	  if (dropdownContent.style.display === 'block') {
		dropdownContent.style.display = 'none';
	  } else {
		dropdownContent.style.display = 'block';
	  }
	});
	</script>
  
  <!-- video Change Scritp  -->
  <script>
	function changeVideo(videoSrc) {
	  var video = document.getElementById('backgroundVideo');
	  video.src = videoSrc;
	  video.load();
	  video.play();
	}
  </script>
  
  
  <!-- POP up video script -->
  <script>
	function showVideo() {
	document.querySelector('.video-popup').style.display = 'block';
  }
  
  function closeVideo() {
	document.querySelector('.video-popup').style.display = 'none';
  }
  
  </script>
  
  <!-- script for pop-up -->
  <script>
	  const overlay = document.querySelector('.popup-overlay');
	  const popup = document.querySelector('.popup');
	  const closeBtn = document.getElementById('popup-close');
	  const h1 = document.getElementById('blure-h1');
	  const navbar = document.getElementById('navbar');
  
	  overlay.style.display = 'block';
	  popup.style.display = 'block';
	  
	  closeBtn.addEventListener('click', function() {
		overlay.style.display = 'none';
		popup.style.display = 'none';
		// h1.style.filter = 'blur(5px)';
		// navbar.style.filter = 'blure';
	  });
  </script>
  <script type="text/javascript">
	// Get the Trigger Button
	var triggerBtn = document.querySelector('.trigger-btn');
  
	// Get the Popup Container
	var popupContainer = document.querySelector('.popup-container');
  
	// Get the Close Button
	var popupClose = document.querySelector('.popup-close');
  
	// Add Event Listener to Trigger Button
	triggerBtn.addEventListener('click', function() {
	  popupContainer.style.display = 'block';
	});
  
	// Add Event Listener to Close Button
	popupClose.addEventListener('click', function() {
	  popupContainer.style.display = 'none';
	});
  
	// Add Event Listener to Outside of Popup Box
	window.addEventListener('click', function(event) {
	  if (event.target == popupContainer) {
		popupContainer.style.display = 'none';
	  }
	});
  </script>

<!-- main code logic script  -->

<script>

  // Function to check if the key pressed is a number or a comma
	function isNumberKey(evt) {
		// Get the ASCII value of the key that was pressed
		var charCode = (evt.which) ? evt.which : event.keyCode;

		// If the key is a digit or a comma, allow input
		if (charCode >= 48 && charCode <= 57 || charCode == 80 || charCode == 112) {
			return true;
		}

		// Otherwise, prevent input
		return false;
	}

  const processTable = document.getElementById("processTable");
  const processIDInput = document.getElementById("processIDInput");
  const arrivalTimeInput = document.getElementById("arrivalTimeInput");
  const cpuBurstTimeInput = document.getElementById("cpuBurstTimeInput");
  const priorityInput = document.getElementById("priorityInput");
  const addButton = document.getElementById("addButton");
  const dropButton = document.getElementById("dropButton");
  const resetButton = document.getElementById("reset");
  const reloadButton = document.getElementById("reloadButton");
  const calculateButton = document.getElementById("calculateButton");
  const resultTable = document.getElementById("resultTable");
  const GanttChartTable = document.getElementById("GanttChart");
  const AvgWaitTime = document.getElementById("AvgWaitTime");
  const AvgTATime = document.getElementById("AvgTATime");

  let processes = [];
  const M = 1000, N = 2;
  let GanttChart = new Array(M);            // create an empty array of length `M`
  for (var i = 0; i < M; i++) {
    GanttChart[i] = new Array(N).fill(0);        // make each element an array
  }
  addButton.addEventListener("click", function () {
    const processID = processIDInput.value;
    const arrivalTime = arrivalTimeInput.value;
    const cpuBurstTime = cpuBurstTimeInput.value;
    const priority = priorityInput.value;
   
    if (processID === "" || arrivalTime === "" || cpuBurstTime === "" || priority === "") {
      alert("All fields are required!");
      return;
    }
    if (cpuBurstTime<=0) {
      alert("Please enter cpu burst time greater than zero");
      return;
    }
    if (arrivalTime<0) {
      alert("Please enter arrival time greater than or equal to zero");
      return;
    }
    if (priority<0) {
      alert("Please enter prirority greater than or equal to zero");
      return;
    }

    processes.push({
      processID,
      arrivalTime: parseInt(arrivalTime),
      cpuBurstTime: parseInt(cpuBurstTime),
      priority: parseInt(priority)
    });

    const row = processTable.insertRow();
    const processIDCell = row.insertCell(0);
    const arrivalTimeCell = row.insertCell(1);
    const cpuBurstTimeCell = row.insertCell(2);
    const priorityCell = row.insertCell(3);

    processIDCell.innerHTML = processID;
    arrivalTimeCell.innerHTML = arrivalTime;
    cpuBurstTimeCell.innerHTML = cpuBurstTime;
    priorityCell.innerHTML = priority;

    processIDInput.value = "";
    arrivalTimeInput.value = "";
    cpuBurstTimeInput.value = "";
    priorityInput.value = "";
  });

  dropButton.addEventListener("click", function () {
    const processID = processIDInput.value;

    if (processID == "") {
      alert("Enter a Process ID to drop!");
      return;
    }

    // delete the process from the array
    const indexToRemove = processes.findIndex(process => process.processID == processID);

    if (indexToRemove == -1) {
      alert("Process not found!");
      return;
    }

    processes.splice(indexToRemove, 1);

    // delete the process from the table
    let indexToDelete = -1;
    for (let i = 1; i < processTable.rows.length; i++) {
      if (processTable.rows[i].cells[0].innerHTML == processID) {
        indexToDelete = i;
        break;
      }
    }

    if (indexToDelete !== -1) {
      processTable.deleteRow(indexToDelete);
    }

    processIDInput.value = "";

  });

  resetButton.addEventListener("click", function () {

    var getValue = document.getElementById("processIDInput");
    if (getValue.value != "") {
      getValue.value = "";
    }
    var getValue1 = document.getElementById("arrivalTimeInput");
    if (getValue1.value != "") {
      getValue1.value = "";
    }
    var getValue2 = document.getElementById("cpuBurstTimeInput");
    if (getValue2.value != "") {
      getValue2.value = "";
    }
    var getValue3 = document.getElementById("priorityInput");
    if (getValue3.value != "") {
      getValue3.value = "";
    }

  });

  calculateButton.addEventListener("click", function () {
    if (processes.length == 0) {
      alert("Add some processes first!");
      return;
    }

    document.getElementById("GanttChart1").style.visibility = "visible";
    addButton.style.display="none";
    dropButton.style.display="none";
    resetButton.style.display="none";
    calculateButton.style.display="none";
    reloadButton.style.visibility = "visible";
    resultTable.style.visibility = "visible";
    AvgTATime.style.visibility = "visible";
    AvgWaitTime.style.visibility = "visible";

    const result = priorityScheduling(processes);

    result.forEach(process => {
      const row = resultTable.insertRow();
      const processIDCell = row.insertCell(0);
      const arrivalTimeCell = row.insertCell(1);
      const cpuBurstTimeCell = row.insertCell(2);
      const priorityCell = row.insertCell(3);
      const completionTimeCell = row.insertCell(4);
      const turnaroundTimeCell = row.insertCell(5);
      const waitingTimeCell = row.insertCell(6);
      const startTimeCell = row.insertCell(7)
      const responseTimeCell = row.insertCell(8);


      processIDCell.innerHTML = process.processID;
      arrivalTimeCell.innerHTML = process.arrivalTime;
      cpuBurstTimeCell.innerHTML = process.cpuBurstTime;
      priorityCell.innerHTML = process.priority;
      completionTimeCell.innerHTML = process.completionTime;
      turnaroundTimeCell.innerHTML = process.turnaroundTime;
      waitingTimeCell.innerHTML = process.waitingTime;
      startTimeCell.innerHTML = process.startTime;
      responseTimeCell.innerHTML = process.responseTime;
    });
  });


  // logic
  function priorityScheduling(processes) {

    const n = processes.length;
    burst_remaining = new Array(n).fill(0);
    let current_time = 0;
    let completed = 0;
    let is_completed = new Array(n).fill(0);
    let prev = -1;   // stores the previous index
    let b = 0;        // to update the array index x
    let a = 0;        // to update the array index y

    for (let i = 0; i < n; i++) {
      burst_remaining[i] = processes[i].cpuBurstTime;
    }


    while (completed != n) {
      let index = -1;
      let max = Number.MAX_SAFE_INTEGER;

      // comparing the processes on the basis of arrival time and then priority
      for (let i = 0; i < n; i++) {
        if (processes[i].arrivalTime <= current_time && is_completed[i] == 0) {
          if (processes[i].priority < max) {
            max = processes[i].priority;
            index = i;
          }

          // if two processes have the same priority but different arrival time
          if (processes[i].priority == max) {
            if (processes[i].arrivalTime < processes[index].arrivalTime) {
              max = processes[i].priority;
              index = i;
            }
          }
        }
      }

      if (index != -1) {

        if (burst_remaining[index] == processes[index].cpuBurstTime) 
        {
          processes[index].startTime = current_time;

          // first process
          if (prev == -1) 
          {
            GanttChart[b][0] = processes[index].startTime;
            GanttChart[b][1] = processes[index].processID;
            b++;
            GanttChart[b][0] = processes[index].startTime;
          }
        }
        if (prev != index && prev != -1) 
        {
          let a = b;
          GanttChart[b][1] = processes[index].processID;
          b++;
          GanttChart[b][0] = GanttChart[a][0];
        }

        GanttChart[b][0] = GanttChart[b][0] + 1;
        burst_remaining[index] -= 1;
        current_time++;


        if (burst_remaining[index] == 0) {

          processes[index].completionTime = current_time;
          processes[index].turnaroundTime = processes[index].completionTime - processes[index].arrivalTime;
          processes[index].waitingTime = processes[index].turnaroundTime - processes[index].cpuBurstTime;
          processes[index].responseTime = processes[index].startTime - processes[index].arrivalTime;

          is_completed[index] = 1;
          completed++;
        }
        prev = index;
      }
      else {
        current_time++;
      }

    }
    let avgWaitingTime = 0;
    let avgTurnAroundTime = 0;
    for (let i = 0; i < n; i++) {
      avgWaitingTime += processes[i].waitingTime;
      avgTurnAroundTime += processes[i].turnaroundTime;
    }
    avgWaitingTime = avgWaitingTime / n;
    avgTurnAroundTime = avgTurnAroundTime / n;
    
    document.getElementById("avgWaitTime").innerHTML = avgWaitingTime;
    document.getElementById("avgTATime").innerHTML = avgTurnAroundTime;

    // Gantt Chart
    let row1 = GanttChartTable.insertRow();
    let row2 = GanttChartTable.insertRow();
    let row3 = GanttChartTable.insertRow();
    row1.insertCell(0).innerHTML = "Start Time";
    row2.insertCell(0).innerHTML = "Running Process";
    row3.insertCell(0).innerHTML = "End Time";
    for (let i = 0; i < 100; i++) {
      let a = i;
      a++;
      if (GanttChart[i][1] == 0) {
        break;
      }
      else {
        row1.insertCell(a).innerHTML = GanttChart[i][0];    // start time
        row2.insertCell(a).innerHTML = GanttChart[i][1];    // process id
        row3.insertCell(a).innerHTML = GanttChart[a][0];    // end time
      }

    }
    fetch("/priority", {
    method: 'POST',             // use HTTP POST method to send data to server
    headers: {                  // set content type to JSON
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({     // convert data into a JSON string
        processes:processes
     }),
  }).then((response) => response.json())    // parse response as JSON
    .then((data) => {                       // handle successful response
      console.log('Success:', data);
    })
    .catch((error) => {                     // handle error
      console.error('Error:', error);
    });


    return processes;
  }

</script>
<script src="Script/script.js"></script>

